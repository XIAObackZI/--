<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿç©ºå†¥æƒ³æ—¶é’Ÿ</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background: #0d1b2a;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            overflow: hidden;
        }

        .nebula-timer {
            position: relative;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, 
                #0d1b2a 0%,
                #1b2735 40%,
                #2d3947 100%);
            animation: quantum-fluctuation 2s infinite;
        }

        @keyframes quantum-fluctuation {
            0% { filter: blur(0px); }
            50% { filter: blur(0.5px) hue-rotate(5deg); }
            100% { filter: blur(0px); }
        }

        .quantum-interface {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .pulsar-orbit {
            width: 150px;
            height: 150px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            position: relative;
            margin: 0 auto 20px;
        }

        #neutron-star-orbit {
            stroke-dasharray: 471;
            stroke-dashoffset: 471;
            transition: stroke-dashoffset 0.1s linear;
        }

        .timer-display {
            font-size: 48px;
            margin: 20px 0;
            font-family: monospace;
            color: #4fc3f7;
        }

        .phase-display {
            font-size: 24px;
            margin: 10px 0;
            color: #81d4fa;
        }

        .control-panel {
            margin-top: 20px;
        }

        button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin: 0 5px;
            transition: all 0.3s;
        }

        button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        button[data-state="running"] {
            background: #f44336;
        }

        .settings-panel {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
        }

        #stars-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* æ·»åŠ è®¾ç½®é¢æ¿æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: rgba(13, 27, 42, 0.95);
            border-radius: 15px;
            padding: 30px;
            width: 80%;
            max-width: 500px;
            color: white;
            box-shadow: 0 0 30px rgba(0, 123, 255, 0.5);
        }

        .settings-group {
            margin-bottom: 20px;
        }
        
        .settings-title {
            font-size: 18px;
            margin-bottom: 10px;
            color: #4fc3f7;
        }

        .settings-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }

        .option-btn {
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option-btn.active {
            background: #1e88e5;
            border-color: #1e88e5;
        }

        .volume-control {
            width: 100%;
            margin: 10px 0;
        }

        .achievement {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }

        .achievement-icon {
            width: 30px;
            height: 30px;
            margin-right: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .achievement-info {
            flex-grow: 1;
        }

        .achievement-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .achievement-progress {
            font-size: 14px;
            color: #81d4fa;
        }

        .achievement.completed {
            background: rgba(76, 175, 80, 0.2);
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            background: rgba(13, 27, 42, 0.9);
            border-radius: 10px;
            color: white;
            transform: translateX(120%);
            transition: transform 0.3s;
            z-index: 1000;
            box-shadow: 0 0 20px rgba(0, 123, 255, 0.3);
        }

        .notification.show {
            transform: translateX(0);
        }

        /* æé†’äº‹é¡¹æ ·å¼ */
        #reminders-modal .modal-content {
            max-height: 80vh;
            overflow-y: auto;
        }

        .reminder-item {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .reminder-item:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .reminder-checkbox {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.5);
            margin-right: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s;
        }

        .reminder-checkbox.checked {
            background: #4CAF50;
            border-color: #4CAF50;
        }

        .reminder-checkbox.checked::after {
            content: 'âœ“';
            color: white;
            font-size: 14px;
        }

        .reminder-content {
            flex-grow: 1;
        }

        .reminder-title {
            font-size: 16px;
            margin-bottom: 4px;
        }

        .reminder-title.completed {
            text-decoration: line-through;
            opacity: 0.7;
        }

        .reminder-date {
            font-size: 12px;
            color: #81d4fa;
        }

        .reminder-actions {
            display: flex;
            gap: 5px;
        }

        .reminder-action-btn {
            background: none;
            border: none;
            color: #ccc;
            cursor: pointer;
            padding: 5px;
            font-size: 14px;
            border-radius: 4px;
        }

        .reminder-action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .add-reminder-btn {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border: 1px dashed rgba(255, 255, 255, 0.3);
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            margin: 15px 0;
        }

        .add-reminder-icon {
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }

        .reminder-form {
            display: none;
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #81d4fa;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .form-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .category-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 8px;
        }

        .category-badge.work {
            background: #2196F3;
        }

        .category-badge.personal {
            background: #9C27B0;
        }

        .category-badge.health {
            background: #4CAF50;
        }

        .category-badge.study {
            background: #FF9800;
        }
    </style>
</head>
<body>
    <div class="nebula-timer">
        <canvas id="stars-container"></canvas>
        
        <div class="quantum-interface">
            <svg class="pulsar-orbit" viewBox="0 0 150 150">
                <circle id="neutron-star-orbit" 
                        cx="75" cy="75" r="73" 
                        fill="none" 
                        stroke="#4fc3f7" 
                        stroke-width="4"/>
            </svg>
            
            <div class="timer-display" id="timer">25:00</div>
            <div class="phase-display" id="phase">è¶…ç»´åº¦èšç„¦</div>
            
            <div class="control-panel">
                <button id="start-btn">å¼€å§‹ä¸“æ³¨</button>
                <button id="pause-btn" disabled>æš‚åœ</button>
                <button id="stop-btn" disabled>ç»“æŸ</button>
            </div>
            </div>
            
        <div class="settings-panel">
            <button id="settings-btn">è®¾ç½®</button>
            <button id="achievements-btn">æˆå°±</button>
            <button id="reminders-btn">æé†’</button>
            <button onclick="window.location.href='menu.html'">è¿”å›èœå•</button>
        </div>
            </div>
            
    <!-- è®¾ç½®é¢æ¿ -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <h2 class="settings-title">è®¾ç½®</h2>
            
            <div class="settings-group">
                <h3>èƒŒæ™¯ä¸»é¢˜</h3>
                <div class="settings-options">
                    <button class="option-btn active" data-theme="default">é»˜è®¤æ˜Ÿç©º</button>
                    <button class="option-btn" data-theme="aurora">æå…‰</button>
                    <button class="option-btn" data-theme="galaxy">é“¶æ²³</button>
                </div>
            </div>
            
            <div class="settings-group">
                <h3>éŸ³æ•ˆ</h3>
                <div class="settings-options">
                    <button class="option-btn active" data-sound="nasa">NASAéŸ³æ•ˆ</button>
                    <button class="option-btn" data-sound="nature">è‡ªç„¶éŸ³æ•ˆ</button>
                    <button class="option-btn" data-sound="minimal">ç®€çº¦éŸ³æ•ˆ</button>
                </div>
                <div class="volume-control">
                    <label>éŸ³é‡: <span id="volume-value">80%</span></label>
                    <input type="range" id="volume-slider" min="0" max="100" value="80">
                    <button onclick="testSound()">æµ‹è¯•éŸ³æ•ˆ</button>
            </div>
        </div>
        
            <div class="settings-group">
                <h3>ä¸“æ³¨æ—¶é—´</h3>
                <div class="settings-options">
                    <button class="option-btn active" data-duration="25">25åˆ†é’Ÿ</button>
                    <button class="option-btn" data-duration="45">45åˆ†é’Ÿ</button>
                    <button class="option-btn" data-duration="60">60åˆ†é’Ÿ</button>
        </div>
    </div>
    
            <button onclick="closeSettings()">ä¿å­˜è®¾ç½®</button>
        </div>
    </div>

    <!-- æˆå°±é¢æ¿ -->
    <div class="modal" id="achievements-modal">
        <div class="modal-content">
            <h2 class="settings-title">æˆå°±</h2>
            
            <div class="achievements-list">
                <div class="achievement" id="first-focus">
                    <div class="achievement-icon">ğŸŒŸ</div>
                    <div class="achievement-info">
                        <div class="achievement-title">åˆæ¬¡ä¸“æ³¨</div>
                        <div class="achievement-progress">å®Œæˆç¬¬ä¸€æ¬¡ä¸“æ³¨</div>
        </div>
    </div>
    
                <div class="achievement" id="focus-master">
                    <div class="achievement-icon">ğŸ‘‘</div>
                    <div class="achievement-info">
                        <div class="achievement-title">ä¸“æ³¨å¤§å¸ˆ</div>
                        <div class="achievement-progress">ç´¯è®¡ä¸“æ³¨æ—¶é—´: <span>0</span>/10å°æ—¶</div>
                    </div>
                </div>
                
                <div class="achievement" id="persistent">
                    <div class="achievement-icon">ğŸ”¥</div>
                    <div class="achievement-info">
                        <div class="achievement-title">æŒä¹‹ä»¥æ’</div>
                        <div class="achievement-progress">è¿ç»­ä¸“æ³¨: <span>0</span>/7å¤©</div>
                    </div>
                </div>
                
                <div class="achievement" id="early-bird">
                    <div class="achievement-icon">ğŸŒ…</div>
                    <div class="achievement-info">
                        <div class="achievement-title">æ—©èµ·è¾¾äºº</div>
                        <div class="achievement-progress">æ¸…æ™¨ä¸“æ³¨: <span>0</span>/5æ¬¡</div>
                    </div>
                </div>
            </div>
            
            <button onclick="closeAchievements()">å…³é—­</button>
        </div>
    </div>

    <!-- é€šçŸ¥æç¤º -->
    <div class="notification" id="notification"></div>

    <!-- æé†’äº‹é¡¹é¢æ¿ -->
    <div class="modal" id="reminders-modal">
        <div class="modal-content">
            <h2 class="settings-title">æˆ‘çš„æé†’</h2>
            
            <div id="reminders-list">
                <!-- æé†’äº‹é¡¹å°†åœ¨æ­¤åŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <button class="add-reminder-btn" id="show-add-form">
                <div class="add-reminder-icon">+</div>
                <span>æ·»åŠ æ–°æé†’</span>
            </button>
            
            <div class="reminder-form" id="reminder-form">
                <div class="form-group">
                    <label for="reminder-title">æ ‡é¢˜</label>
                    <input type="text" id="reminder-title" placeholder="è¾“å…¥æé†’æ ‡é¢˜">
        </div>
                
                <div class="form-group">
                    <label for="reminder-date">æ—¥æœŸä¸æ—¶é—´</label>
                    <input type="datetime-local" id="reminder-date">
    </div>

                <div class="form-group">
                    <label for="reminder-category">åˆ†ç±»</label>
                    <select id="reminder-category">
                        <option value="work">å·¥ä½œ</option>
                        <option value="personal">ä¸ªäºº</option>
                        <option value="health">å¥åº·</option>
                        <option value="study">å­¦ä¹ </option>
                    </select>
                </div>
                
                <input type="hidden" id="reminder-id" value="">
                <input type="hidden" id="edit-mode" value="add">
                
                <div class="form-buttons">
                    <button onclick="cancelAddReminder()">å–æ¶ˆ</button>
                    <button onclick="saveReminder()">ä¿å­˜</button>
                </div>
            </div>
            
            <button onclick="closeReminders()">å…³é—­</button>
        </div>
    </div>

    <script>
        // éŸ³æ•ˆç®¡ç†å™¨
        class SoundManager {
            constructor() {
                this.sounds = {
                    nasa: new Audio('assets/sounds/nasa.mp3'),
                    nature: new Audio('assets/sounds/nature.mp3'),
                    minimal: new Audio('assets/sounds/minimal.mp3'),
                    complete: new Audio('assets/sounds/complete.mp3')
                };
                
                this.currentSound = 'nasa';
                this.volume = 0.8;
                
                // åˆå§‹åŒ–éŸ³é‡
                Object.values(this.sounds).forEach(sound => {
                    sound.volume = this.volume;
                });
            }
            
            setVolume(value) {
                this.volume = value;
                Object.values(this.sounds).forEach(sound => {
                    sound.volume = value;
                });
            }
            
            play(soundName) {
                const sound = this.sounds[soundName];
                if (sound) {
                    sound.currentTime = 0;
                    sound.play().catch(e => console.log('æ’­æ”¾éŸ³æ•ˆå¤±è´¥:', e));
                }
            }
            
            stop(soundName) {
                const sound = this.sounds[soundName];
                if (sound) {
                    sound.pause();
                    sound.currentTime = 0;
                }
            }
            
            testCurrentSound() {
                this.play(this.currentSound);
            }
        }

        // æˆå°±ç®¡ç†å™¨
        class AchievementManager {
            constructor() {
                this.achievements = {
                    firstFocus: { completed: false },
                    focusMaster: { progress: 0, target: 36000000 }, // 10å°æ—¶æ¢ç®—ä¸ºæ¯«ç§’
                    persistent: { progress: 0, target: 7 },
                    earlyBird: { progress: 0, target: 5 }
                };
                
                this.loadAchievements();
            }
            
            loadAchievements() {
                const saved = localStorage.getItem('achievements');
                if (saved) {
                    this.achievements = JSON.parse(saved);
                }
                this.updateUI();
            }
            
            saveAchievements() {
                localStorage.setItem('achievements', JSON.stringify(this.achievements));
            }
            
            updateProgress(type, value) {
                switch (type) {
                    case 'firstFocus':
                        if (!this.achievements.firstFocus.completed) {
                            this.achievements.firstFocus.completed = true;
                            this.showNotification('æˆå°±è§£é”: åˆæ¬¡ä¸“æ³¨');
                        }
                        break;
                    case 'focusMaster':
                        this.achievements.focusMaster.progress += value;
                        if (this.achievements.focusMaster.progress >= this.achievements.focusMaster.target) {
                            this.showNotification('æˆå°±è§£é”: ä¸“æ³¨å¤§å¸ˆ');
                        }
                        break;
                    case 'persistent':
                        this.achievements.persistent.progress += 1;
                        if (this.achievements.persistent.progress >= this.achievements.persistent.target) {
                            this.showNotification('æˆå°±è§£é”: æŒä¹‹ä»¥æ’');
                        }
                        break;
                    case 'earlyBird':
                        if (new Date().getHours() < 9) { // æ—©äº9ç‚¹ç®—ä½œæ—©èµ·
                            this.achievements.earlyBird.progress += 1;
                            if (this.achievements.earlyBird.progress >= this.achievements.earlyBird.target) {
                                this.showNotification('æˆå°±è§£é”: æ—©èµ·è¾¾äºº');
                            }
                        }
                        break;
                }
                
                this.saveAchievements();
                this.updateUI();
            }
            
            updateUI() {
                // æ›´æ–°æˆå°±æ˜¾ç¤º
                const elements = {
                    firstFocus: document.getElementById('first-focus'),
                    focusMaster: document.getElementById('focus-master'),
                    persistent: document.getElementById('persistent'),
                    earlyBird: document.getElementById('early-bird')
                };
                
                if (this.achievements.firstFocus.completed) {
                    elements.firstFocus.classList.add('completed');
                }
                
                elements.focusMaster.querySelector('.achievement-progress span').textContent = 
                    Math.floor(this.achievements.focusMaster.progress / 3600000); // è½¬æ¢ä¸ºå°æ—¶
                
                elements.persistent.querySelector('.achievement-progress span').textContent = 
                    this.achievements.persistent.progress;
                
                elements.earlyBird.querySelector('.achievement-progress span').textContent = 
                    this.achievements.earlyBird.progress;
            }
            
            showNotification(message) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        }

        // è®¾ç½®ç®¡ç†å™¨
        class SettingsManager {
            constructor() {
                this.settings = {
                    theme: 'default',
                    sound: 'nasa',
                    volume: 0.8,
                    duration: 25
                };
                
                this.loadSettings();
                this.setupEventListeners();
            }
            
            loadSettings() {
                const saved = localStorage.getItem('timerSettings');
                if (saved) {
                    this.settings = JSON.parse(saved);
                }
                this.applySettings();
            }
            
            saveSettings() {
                localStorage.setItem('timerSettings', JSON.stringify(this.settings));
            }
            
            setupEventListeners() {
                // ä¸»é¢˜é€‰æ‹©
                document.querySelectorAll('[data-theme]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.setTheme(btn.dataset.theme);
                    });
                });
                
                // éŸ³æ•ˆé€‰æ‹©
                document.querySelectorAll('[data-sound]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.setSound(btn.dataset.sound);
                    });
                });
                
                // éŸ³é‡æ§åˆ¶
                const volumeSlider = document.getElementById('volume-slider');
                volumeSlider.addEventListener('input', () => {
                    this.setVolume(volumeSlider.value / 100);
                });
                
                // æ—¶é•¿é€‰æ‹©
                document.querySelectorAll('[data-duration]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.setDuration(parseInt(btn.dataset.duration));
                    });
                });
            }
            
            setTheme(theme) {
                this.settings.theme = theme;
                this.applySettings();
                this.saveSettings();
            }
            
            setSound(sound) {
                this.settings.sound = sound;
                soundManager.currentSound = sound;
                this.applySettings();
                this.saveSettings();
            }
            
            setVolume(volume) {
                this.settings.volume = volume;
                document.getElementById('volume-value').textContent = `${Math.round(volume * 100)}%`;
                soundManager.setVolume(volume);
                this.saveSettings();
            }
            
            setDuration(duration) {
                this.settings.duration = duration;
                this.applySettings();
                this.saveSettings();
            }
            
            applySettings() {
                // åº”ç”¨ä¸»é¢˜
                document.body.className = `theme-${this.settings.theme}`;
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                document.querySelectorAll('[data-theme]').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.theme === this.settings.theme);
                });
                
                document.querySelectorAll('[data-sound]').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.sound === this.settings.sound);
                });
                
                document.querySelectorAll('[data-duration]').forEach(btn => {
                    btn.classList.toggle('active', parseInt(btn.dataset.duration) === this.settings.duration);
                });
                
                // æ›´æ–°éŸ³é‡æ»‘å—
                document.getElementById('volume-slider').value = this.settings.volume * 100;
                document.getElementById('volume-value').textContent = `${Math.round(this.settings.volume * 100)}%`;
            }
        }

        // å…¨å±€å®ä¾‹
        const soundManager = new SoundManager();
        const achievementManager = new AchievementManager();
        const settingsManager = new SettingsManager();
        
        // æé†’äº‹é¡¹ç®¡ç†å™¨
        class ReminderManager {
            constructor() {
                this.reminders = [];
                this.loadReminders();
                this.setupNotifications();
            }
            
            loadReminders() {
                const saved = localStorage.getItem('reminders');
                if (saved) {
                    this.reminders = JSON.parse(saved);
                }
                this.renderReminders();
                this.checkDueReminders();
            }
            
            saveReminders() {
                localStorage.setItem('reminders', JSON.stringify(this.reminders));
            }
            
            addReminder(title, dueDate, category) {
                const reminder = {
                    id: Date.now(),
                    title,
                    dueDate,
                    category,
                    completed: false,
                    createdAt: new Date().toISOString()
                };
                
                this.reminders.push(reminder);
                this.saveReminders();
                this.renderReminders();
                this.scheduleNotification(reminder);
                
                return reminder;
            }
            
            updateReminder(id, title, dueDate, category) {
                const reminder = this.reminders.find(r => r.id === id);
                if (reminder) {
                    reminder.title = title;
                    reminder.dueDate = dueDate;
                    reminder.category = category;
                    
                    this.saveReminders();
                    this.renderReminders();
                    this.scheduleNotification(reminder);
                }
            }
            
            toggleComplete(id) {
                const reminder = this.reminders.find(r => r.id === id);
                if (reminder) {
                    reminder.completed = !reminder.completed;
                    this.saveReminders();
                    this.renderReminders();
                }
            }
            
            deleteReminder(id) {
                this.reminders = this.reminders.filter(r => r.id !== id);
                this.saveReminders();
                this.renderReminders();
            }
            
            getReminder(id) {
                return this.reminders.find(r => r.id === parseInt(id));
            }
            
            renderReminders() {
                const container = document.getElementById('reminders-list');
                if (!container) return;
                
                container.innerHTML = '';
                
                // æŒ‰æ—¥æœŸæ’åº
                const sortedReminders = [...this.reminders].sort((a, b) => {
                    // å·²å®Œæˆçš„æ”¾æœ€å
                    if (a.completed && !b.completed) return 1;
                    if (!a.completed && b.completed) return -1;
                    
                    // æœªå®ŒæˆæŒ‰æ—¥æœŸæ’åº
                    return new Date(a.dueDate) - new Date(b.dueDate);
                });
                
                if (sortedReminders.length === 0) {
                    container.innerHTML = '<p style="text-align: center; opacity: 0.7;">æ²¡æœ‰æé†’äº‹é¡¹</p>';
                    return;
                }
                
                sortedReminders.forEach(reminder => {
                    const dueDate = new Date(reminder.dueDate);
                    const formattedDate = dueDate.toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    const isPastDue = !reminder.completed && new Date() > dueDate;
                    
                    const reminderEl = document.createElement('div');
                    reminderEl.className = 'reminder-item';
                    reminderEl.innerHTML = `
                        <div class="reminder-checkbox ${reminder.completed ? 'checked' : ''}" 
                             onclick="reminderManager.toggleComplete(${reminder.id})"></div>
                        <div class="reminder-content">
                            <div class="reminder-title ${reminder.completed ? 'completed' : ''}">${reminder.title}</div>
                            <div class="reminder-date" style="${isPastDue ? 'color: #ff5252;' : ''}">
                                ${isPastDue ? 'å·²è¿‡æœŸ - ' : ''}${formattedDate}
                                <span class="category-badge ${reminder.category}">${this.getCategoryName(reminder.category)}</span>
                            </div>
                        </div>
                        <div class="reminder-actions">
                            <button class="reminder-action-btn" onclick="editReminder(${reminder.id})" title="ç¼–è¾‘">
                                <span style="font-size: 16px;">âœ</span>
                            </button>
                            <button class="reminder-action-btn" onclick="reminderManager.deleteReminder(${reminder.id})" title="åˆ é™¤">
                                <span style="font-size: 16px;">Ã—</span>
                            </button>
                        </div>
                    `;
                    
                    container.appendChild(reminderEl);
                });
            }
            
            getCategoryName(category) {
                const categories = {
                    work: 'å·¥ä½œ',
                    personal: 'ä¸ªäºº',
                    health: 'å¥åº·',
                    study: 'å­¦ä¹ '
                };
                return categories[category] || category;
            }
            
            setupNotifications() {
                // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦æœ‰åˆ°æœŸçš„æé†’
                setInterval(() => this.checkDueReminders(), 60000);
            }
            
            checkDueReminders() {
                const now = new Date();
                this.reminders.forEach(reminder => {
                    if (!reminder.completed) {
                        const dueDate = new Date(reminder.dueDate);
                        
                        // åˆ°æœŸæ—¶é—´ä¸å½“å‰æ—¶é—´çš„å·®è·åœ¨ä¸€åˆ†é’Ÿä»¥å†…
                        if (Math.abs(dueDate - now) < 60000 && dueDate > now) {
                            this.notifyReminder(reminder);
                        }
                    }
                });
            }
            
            scheduleNotification(reminder) {
                // è®¡ç®—è·ç¦»æé†’æ—¶é—´è¿˜æœ‰å¤šä¹…ï¼ˆæ¯«ç§’ï¼‰
                const dueDate = new Date(reminder.dueDate);
                const now = new Date();
                const timeUntilDue = dueDate - now;
                
                // å¦‚æœæé†’æ—¶é—´è¿˜æ²¡åˆ°ï¼Œåˆ™è®¾ç½®è®¡æ—¶å™¨
                if (timeUntilDue > 0) {
                    setTimeout(() => {
                        // æ£€æŸ¥æé†’æ˜¯å¦ä»ç„¶å­˜åœ¨ä¸”æœªå®Œæˆ
                        const currentReminder = this.reminders.find(r => r.id === reminder.id);
                        if (currentReminder && !currentReminder.completed) {
                            this.notifyReminder(currentReminder);
                        }
                    }, timeUntilDue);
                }
            }
            
            notifyReminder(reminder) {
                soundManager.play('complete');
                
                // æ˜¾ç¤ºæµè§ˆå™¨é€šçŸ¥
                if ("Notification" in window) {
                    Notification.requestPermission().then(permission => {
                        if (permission === "granted") {
                            new Notification(reminder.title, {
                                body: `åˆ†ç±»: ${this.getCategoryName(reminder.category)}`,
                                icon: '/assets/images/notification-icon.png'
                            });
                        }
                    });
                }
                
                // æ˜¾ç¤ºåº”ç”¨å†…é€šçŸ¥
                const notification = document.getElementById('notification');
                notification.textContent = `æé†’: ${reminder.title}`;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 5000);
            }
        }
        
        const reminderManager = new ReminderManager();
        
        // UIæ§åˆ¶å‡½æ•°
        function showSettings() {
            document.getElementById('settings-modal').style.display = 'flex';
        }

        function closeSettings() {
            document.getElementById('settings-modal').style.display = 'none';
        }

        function showAchievements() {
            document.getElementById('achievements-modal').style.display = 'flex';
        }

        function closeAchievements() {
            document.getElementById('achievements-modal').style.display = 'none';
        }
        
        function showReminders() {
            document.getElementById('reminders-modal').style.display = 'flex';
            reminderManager.renderReminders();
        }
        
        function closeReminders() {
            document.getElementById('reminders-modal').style.display = 'none';
        }
        
        function showAddReminderForm() {
            document.getElementById('reminder-form').style.display = 'block';
            document.getElementById('show-add-form').style.display = 'none';
            
            // é‡ç½®è¡¨å•
            document.getElementById('reminder-title').value = '';
            document.getElementById('reminder-id').value = '';
            document.getElementById('edit-mode').value = 'add';
            
            // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºå½“å‰æ—¶é—´å1å°æ—¶
            const now = new Date();
            now.setHours(now.getHours() + 1);
            now.setMinutes(0);
            
            const dateString = now.toISOString().slice(0, 16);
            document.getElementById('reminder-date').value = dateString;
        }
        
        function cancelAddReminder() {
            document.getElementById('reminder-form').style.display = 'none';
            document.getElementById('show-add-form').style.display = 'flex';
        }
        
        function saveReminder() {
            const title = document.getElementById('reminder-title').value.trim();
            const dueDate = document.getElementById('reminder-date').value;
            const category = document.getElementById('reminder-category').value;
            const editMode = document.getElementById('edit-mode').value;
            const reminderId = document.getElementById('reminder-id').value;
            
            if (!title) {
                alert('è¯·è¾“å…¥æé†’æ ‡é¢˜');
                return;
            }
            
            if (!dueDate) {
                alert('è¯·é€‰æ‹©æé†’æ—¶é—´');
                return;
            }
            
            if (editMode === 'edit' && reminderId) {
                reminderManager.updateReminder(parseInt(reminderId), title, dueDate, category);
            } else {
                reminderManager.addReminder(title, dueDate, category);
            }
            
            // é‡ç½®è¡¨å•
            document.getElementById('reminder-title').value = '';
            document.getElementById('reminder-form').style.display = 'none';
            document.getElementById('show-add-form').style.display = 'flex';
        }
        
        function editReminder(id) {
            const reminder = reminderManager.getReminder(id);
            if (!reminder) return;
            
            // æ˜¾ç¤ºè¡¨å•
            document.getElementById('reminder-form').style.display = 'block';
            document.getElementById('show-add-form').style.display = 'none';
            
            // å¡«å……è¡¨å•æ•°æ®
            document.getElementById('reminder-title').value = reminder.title;
            document.getElementById('reminder-date').value = reminder.dueDate.slice(0, 16);
            document.getElementById('reminder-category').value = reminder.category;
            document.getElementById('reminder-id').value = reminder.id;
            document.getElementById('edit-mode').value = 'edit';
        }

        function testSound() {
            soundManager.testCurrentSound();
        }

        // äº‹ä»¶ç›‘å¬
        document.getElementById('settings-btn').addEventListener('click', showSettings);
        document.getElementById('achievements-btn').addEventListener('click', showAchievements);
        document.getElementById('reminders-btn').addEventListener('click', showReminders);
        document.getElementById('show-add-form').addEventListener('click', showAddReminderForm);

        // æ˜Ÿç©ºåŠ¨ç”»
        class StarryBackground {
            constructor() {
                this.canvas = document.getElementById('stars-container');
                this.ctx = this.canvas.getContext('2d');
                this.stars = [];
                this.resize();
                this.init();
                this.animate();
                
                window.addEventListener('resize', () => this.resize());
            }
            
            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }
            
            init() {
                const starCount = Math.floor((this.canvas.width * this.canvas.height) / 3000);
                
                for (let i = 0; i < starCount; i++) {
                    this.stars.push({
                        x: Math.random() * this.canvas.width,
                        y: Math.random() * this.canvas.height,
                        size: Math.random() * 2,
                        brightness: Math.random(),
                        speed: Math.random() * 0.05
                    });
                }
            }
            
            animate() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                this.stars.forEach(star => {
                    star.brightness = Math.abs(Math.sin(Date.now() * star.speed));
                    
                    this.ctx.beginPath();
                    this.ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                    this.ctx.fillStyle = `rgba(255, 255, 255, ${star.brightness})`;
                    this.ctx.fill();
                });
                
                requestAnimationFrame(() => this.animate());
            }
        }

        // ä¸“æ³¨æ—¶é’Ÿ
        class StellarTimer {
            constructor() {
                this.worker = new Worker('timer.worker.js');
                this.timerDisplay = document.getElementById('timer');
                this.phaseDisplay = document.getElementById('phase');
                this.startBtn = document.getElementById('start-btn');
                this.pauseBtn = document.getElementById('pause-btn');
                this.stopBtn = document.getElementById('stop-btn');
                
                this.setupEventListeners();
                this.setupWorkerMessageHandler();
            }
            
            setupEventListeners() {
                this.startBtn.addEventListener('click', () => this.start());
                this.pauseBtn.addEventListener('click', () => this.pause());
                this.stopBtn.addEventListener('click', () => this.stop());
            }
            
            setupWorkerMessageHandler() {
                this.worker.onmessage = (e) => {
                    const { type, payload } = e.data;
                    
                    switch (type) {
                        case 'TICK':
                            this.updateDisplay(payload);
                            break;
                        case 'COMPLETE':
                            this.handlePhaseComplete(payload);
                            break;
                    }
                };
            }
            
            start() {
                const duration = settingsManager.settings.duration * 60 * 1000; // ä½¿ç”¨è®¾ç½®ä¸­çš„æ—¶é•¿
                this.worker.postMessage({
                    type: 'START',
                    payload: { duration, phaseType: 'focus' }
                });
                
                this.startBtn.disabled = true;
                this.pauseBtn.disabled = false;
                this.stopBtn.disabled = false;
                this.startBtn.setAttribute('data-state', 'running');
            }
            
            pause() {
                this.worker.postMessage({ type: 'PAUSE' });
                this.pauseBtn.textContent = 'ç»§ç»­';
                this.pauseBtn.onclick = () => this.resume();
            }
            
            resume() {
                this.worker.postMessage({ type: 'RESUME' });
                this.pauseBtn.textContent = 'æš‚åœ';
                this.pauseBtn.onclick = () => this.pause();
            }
            
            stop() {
                this.worker.postMessage({ type: 'STOP' });
                this.reset();
            }
            
            reset() {
                this.startBtn.disabled = false;
                this.pauseBtn.disabled = true;
                this.stopBtn.disabled = true;
                this.startBtn.removeAttribute('data-state');
                this.timerDisplay.textContent = `${settingsManager.settings.duration}:00`;
                this.phaseDisplay.textContent = 'è¶…ç»´åº¦èšç„¦';
            }
            
            updateDisplay({ remainingTime, progress }) {
                const minutes = Math.floor(remainingTime / 60000);
                const seconds = Math.floor((remainingTime % 60000) / 1000);
                this.timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                const orbit = document.getElementById('neutron-star-orbit');
                orbit.style.strokeDashoffset = 471 * (1 - progress);
            }
            
            handlePhaseComplete({ phaseType }) {
                if (phaseType === 'focus') {
                    soundManager.play('complete');
                    achievementManager.updateProgress('firstFocus');
                    achievementManager.updateProgress('focusMaster', settingsManager.settings.duration * 60 * 1000);
                    achievementManager.updateProgress('persistent');
                    achievementManager.updateProgress('earlyBird');
                    
                    this.showNotification('ä¸“æ³¨é˜¶æ®µå®Œæˆ', 'æ˜¯å¦å¼€å§‹ä¼‘æ¯ï¼Ÿ');
                } else {
                    this.showNotification('ä¼‘æ¯ç»“æŸ', 'å‡†å¤‡å¼€å§‹æ–°çš„ä¸“æ³¨ï¼Ÿ');
                }
                this.reset();
            }
            
            showNotification(title, body) {
                if (!("Notification" in window)) return;
                
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") {
                        new Notification(title, {
                            body: body,
                            icon: '/assets/images/notification-icon.png'
                        });
                    }
                });
            }
        }
        
        // åˆå§‹åŒ–
        window.onload = function() {
            new StarryBackground();
            new StellarTimer();
        };
    </script>
</body>
</html>
